{{define "agents.html"}}
{{template "layout" .}}
{{end}}

{{define "Title"}}Agents{{end}}

{{define "content"}}
<div class="space-y-6">
    <h1 class="text-2xl font-bold">Agents</h1>

    <form method="get" action="/agents" class="bg-gray-800 rounded-lg p-4 flex flex-wrap items-center gap-3 text-sm">
        <span class="text-gray-400">Search</span>
        <input
            id="agents-search"
            name="q"
            value="{{.Query}}"
            placeholder="Search agents"
            hx-get="/agents"
            hx-trigger="input changed delay:300ms"
            hx-target="#agents-list"
            hx-select="#agents-list"
            class="px-2 py-1 bg-gray-900 rounded border border-gray-700 text-gray-200 flex-1 min-w-[16rem]" />
        <span class="text-xs text-gray-500">Tokens: !running !waiting !idle !error !unknown</span>
    </form>

    <div id="agents-list">
    {{if .Groups}}
        <div class="space-y-6">
            {{range .Groups}}
            <div class="space-y-4">
                <div class="flex items-center justify-between text-sm text-gray-400 uppercase tracking-wide">
                    <span>Project: {{.Name}}</span>
                    <span>{{len .Items}} agent{{if ne (len .Items) 1}}s{{end}}</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {{range .Items}}
                    <a href="/agents/{{.Name}}" class="block bg-gray-800 rounded-lg p-6 hover:bg-gray-750 transition-colors">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                                <h2 class="text-xl font-semibold">{{.Name}}</h2>
                            </div>
                            {{if gt .UnreadCount 0}}
                            <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">{{.UnreadCount}} unread</span>
                            {{end}}
                        </div>

                        <dl class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <dt class="text-gray-400">Program</dt>
                                <dd class="font-mono text-blue-400">{{.Program}}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-gray-400">Model</dt>
                                <dd class="font-mono text-purple-400">{{.Model}}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-gray-400">Project</dt>
                                <dd class="font-mono text-green-400">{{.ProjectPath | basename}}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-gray-400">Inbox</dt>
                                <dd>{{.InboxCount}} messages</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-gray-400">Last Active</dt>
                                <dd class="text-gray-300">{{.LastActive.Format "Jan 2, 15:04"}}</dd>
                            </div>
                        </dl>
                    </a>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    {{else}}
        <div class="bg-gray-800 rounded-lg p-8 text-center">
            <p class="text-gray-500">No agents detected</p>
            <p class="text-gray-600 text-sm mt-2">Agents are discovered from MCP Agent Mail registrations</p>
        </div>
    {{end}}
    </div>
</div>
{{end}}
